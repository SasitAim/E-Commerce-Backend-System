<!-- Home Page -->
<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
  <meta name="generator" content="Astro v5.9.2">
  <title>My Store | Graphics Card Online Shop</title>
  <link rel="canonical" href="https://getbootstrap.com/docs/5.3/examples/product/">
  <script src="../assets/js/color-modes.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
  <meta name="theme-color" content="#712cf9">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="style/style.css">
</head>

<body>
  <!-- Nav Bar -->
  <div id="navbar-container"></div>

  <main>

    <!-- อธิบายเกี่ยวกับ หน้า Product -->
    <section class="py-5 text-center container">
      <div class="row">
        <h1 class="fw-light" style="margin-bottom: 20px; text-transform: uppercase;">All product in My Store</h1>
        <div class="col-lg-4 col-md-8 mx-auto">
          <img src="https://mir-s3-cdn-cf.behance.net/project_modules/1400_webp/8e4313112554403.60186ea0c7798.jpg"
            class="img-fluid mb-4" alt="Example">
          <h5 class="fw-light">INTEL</h5>
          <p class="lead text-body-secondary" style="text-align: justify; line-height:1.6; font-size: 0.95rem;">The Arc
            series includes A-series, B-series, and Arc Pro GPUs for gaming
            and content creation, competing with NVIDIA and AMD, and supporting ray tracing and AI upscaling.
          </p>
        </div>
        <div class="col-lg-4 col-md-8 mx-auto">
          <img src="https://wallpaperbat.com/img/9712345-nvidia-wallpaper.jpg" class="img-fluid mb-4" alt="Example">
          <h5 class="fw-light">NVIDIA</h5>
          <p class="lead text-body-secondary" style="text-align: justify; line-height:1.6; font-size: 0.95rem;">The RTX
            series offers high-performance GPUs for gaming and content
            creation, featuring ray tracing, AI, and strong visual fidelity across RTX 20, 30, 40 and 50 models.
          </p>
        </div>
        <div class="col-lg-4 col-md-8 mx-auto">
          <img src="https://cdn.thefpsreview.com/wp-content/uploads/2020/10/amd-logo-ruby-red.jpg.webp"
            class="img-fluid mb-4" alt="Example">
          <h5 class="fw-light">AMD</h5>
          <p class="lead text-body-secondary" style="text-align: justify; line-height:1.6; font-size: 0.95rem;">The
            Radeon RX 9000 series (RDNA 4) is AMD's latest gaming GPU line, offering high performance, visual fidelity,
            AI acceleration, ray tracing, and upscaling.
          </p>
        </div>

      </div>

    </section>

    <!-- Filter Section -->
    <div class="container mb-4">
      <div class="row justify-content-end">
        <!-- Filter by Brand -->
        <div class="col-auto ">
          <select id="brandFilter" class="form-select">
            <option value="all">All Brands</option>
            <option value="NVIDIA">NVIDIA</option>
            <option value="AMD">AMD</option>
            <option value="intel">Intel ARC</option>
          </select>
        </div>

        <!-- Sort by Price -->
        <div class="col-auto">
          <select id="priceSort" class="form-select">
            <option value="none">Sort by Price</option>
            <option value="asc">Price: Low to High</option>
            <option value="desc">Price: High to Low</option>
          </select>
        </div>
      </div>
    </div>

    <div class="album py-5 bg-body-tertiary">
      <div class="container">
        <div class="text-end"><button type="button" class="btn btn-outline-secondary mb-3"
            onclick="openModalCreate()">เพิ่มรายการสินค้า</button></div>
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3" id="productlist">
        </div>
      </div>
    </div>
  </main>

  <footer class="footer-custom py-5">
    <div class="container">
      <div class="row text-center text-md-start align-items-center">

        <!-- Contact Column -->
        <div class="col-md-6 mb-3 mb-md-0">
          <h6 class="fw-bold">My Store</h6>
          <p class="mb-1">
            My Store thanks all our customers for your trust and support. We're proud to deliver top-quality graphic
            cards for the best gaming experience, and we hope you enjoy the very best from us.
          </p>
        </div>


        <!-- Social Media Column -->
        <div class="col-md-3 mb-3 mb-md-0">
          <h6 class="fw-bold">Product</h6>
          <p class="mb-1"><i class="bi bi-nvidia me-2"></i></i>NVIDIA Geforce RTX series</p>
          <p class="mb-1"><i class="bi bi-amd me-2"></i></i>AMD RADEON</p>
          <p class="mb-1"><i class="bi bi-cpu me-2"></i></i>intel ARC™</p>
        </div>

        <!-- Contact Column -->
        <div class="col-md-3 mb-3 mb-md-0">
          <h6 class="fw-bold">Contact</h6>
          <p class="mb-1"><i class="bi bi-telephone-fill me-2"></i>089-765-4321</p>
          <p class="mb-1"><i class="bi bi-envelope-fill me-2"></i>My_Store_s@gmail.com</p>
          <p class="mb-1"><i class="bi bi-geo-alt-fill me-2"></i>location</p>
        </div>

      </div>

      <!-- Footer Bottom -->
      <div class="text-center mt-4">
        <div class="social-icons">
          <a href="#" class="me-3"><i class="bi bi-twitter-x"></i></a>
          <a href="#" class="me-3"><i class="bi bi-instagram"></i></a>
          <a href="#"><i class="bi bi-line"></i></a> 
          <a href="https://www.facebook.com/" target="_blank" class="me-3"><i class="bi bi-facebook"></i></a>
          <a href="https://twitter.com/" target="_blank" class="me-3"><i class="bi bi-twitter-x"></i></a>
          <a href="https://www.instagram.com/" target="_blank" class="me-3"><i class="bi bi-instagram"></i></a>
          <a href="https://line.me/th/" target="_blank"><i class="bi bi-line"></i></a>

        </div>
        <p class="mb-1">All rights reserved &copy; Aug 2025 My Portfolio My Store</p>
        <p><a href="#" class="text-decoration-none">Back to top</a></p>
      </div>
    </div>
  </footer>

  <!-- Modal Create-->
  <div class="modal fade" id="createModal" tabindex="-1" aria-labelledby="createModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="createModalLabel">เพิ่มรายการสินค้า</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body">
          <div class="row">
            <div class="col-3">ชื่อ :</div>
            <div class="col-9"><input class="form-control mb-3" id="createname"></input></div>
          </div>
          <div class="row">
            <div class="col-3">รายละเอียด :</div>
            <div class="col-9"><input class="form-control mb-3" id="createdesc"></input></div>
          </div>
          <div class="row">
            <div class="col-3">url รูปภาพ :</div>
            <div class="col-9"><input class="form-control mb-3" id="createurl"></input></div>
          </div>
          <div class="row">
            <div class="col-3">ราคา :</div>
            <div class="col-9"><input class="form-control mb-3" id="createprice"></input></div>
          </div>
          <div class="row">
            <div class="col-3">จำนวน :</div>
            <div class="col-9"><input class="form-control mb-3" id="createstock"></input></div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal" onclick="Create()">เพิ่มรายการ</button>
        </div>
      </div>
    </div>
  </div>
  <!-- Modal Edit-->
  <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="editModalLabel">แก้ไขรายการ</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body text-center">
          <div style="display:none"><input class="form-control" id="productid"></input></div>
          <div class="row">
            <div class="col-3">ชื่อ :</div>
            <div class="col-9"><input class="form-control mb-3" id="productname"></input></div>
          </div>
          <div class="row">
            <div class="col-3">รายละเอียด :</div>
            <div class="col-9"><input class="form-control mb-3" id="productdesc"></input></div>
          </div>
          <div class="row">
            <div class="col-3">url รูปภาพ :</div>
            <div class="col-9"><input class="form-control mb-3" id="producturl"></input></div>
          </div>
          <div class="row">
            <div class="col-3">ราคา :</div>
            <div class="col-9"><input class="form-control mb-3" id="productprice"></input></div>
          </div>
          <div class="row">
            <div class="col-3">จำนวน :</div>
            <div class="col-9"><input class="form-control mb-3" id="productstock"></input></div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-warning" data-bs-dismiss="modal" onclick="Update()">แก้ไขรายการ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Delete-->
  <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="deleteModalLabel">ลบรายการ</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>

        <div class="modal-body text-center">
          คุณต้องการลบรายการนี้ใช่หรือไม่
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal" onclick="Delete()">ลบรายการนี้</button>
        </div>
      </div>
    </div>
  </div>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <!-- roleGuard -->
  <!-- <script src="/js/roleGuard.js"></script>
  <script>
    requireRole(['sales', 'admin']);
  </script> -->


  <!-- Navbar Script -->
  <script src="/js/navbar.js"></script>
</body>

<script>
  var datas = [];
  var token = localStorage.getItem("token") || "";

  // ================= GET =================
  function getlist() {
    $.ajax({
      url: '/api/products',
      type: 'GET',
      dataType: 'json',
      headers: {
        Authorization: 'Bearer ' + token
      },
      success: function (data) {
        datas = data;
        console.log(datas); // ******
        drawdiv(datas);
      },
      error: function (err) {
        if (err.status === 401 || err.status === 403) {
          alert('คุณไม่มีสิทธิ์เข้าหน้านี้ (เฉพาะ sales / admin)');
          window.location.href = '/login';
        }
      }
    });
  }

  function drawdiv(datas) {
    var productstring = document.getElementById("productlist");
    var str = "";

    for (var i = 0; i < datas.length; i++) {
      str += `
        <div class="col">
          <div class="product-item card shadow-sm">
            <img src="${datas[i].img_url}" class="card-img-top"
              style="height:225px;object-fit:cover;">
            <div class="card-body">
              <h5>${datas[i].name}</h5>
              <p>Price : ${datas[i].price.toLocaleString()} Baht</p>
              <p>Qty : ${datas[i].stock}</p>
              <div class="btn-group">
                <button class="btn btn-sm btn-outline-secondary"
                  onclick="EditShow(${datas[i].id},
                  '${datas[i].name}','${datas[i].description}',
                  '${datas[i].img_url}',${datas[i].price},${datas[i].stock})">
                  Update
                </button>
                <button class="btn btn-sm btn-outline-danger"
                  onclick="DeleteShow(${datas[i].id})">
                  Delete
                </button>
              </div>
            </div>
          </div>
        </div>`;
    }
    productstring.innerHTML = str;
  }

  // ================= CREATE =================
  function openModalCreate() {
    $('#createModal').modal('show');
  }

  function Create() {
    $.ajax({
      url: '/api/products',
      type: 'POST',
      contentType: 'application/json',
      headers: {
        Authorization: 'Bearer ' + token
      },
      data: JSON.stringify({
        name: $("#createname").val(),
        description: $("#createdesc").val(),
        img_url: $("#createurl").val(),
        price: parseFloat($("#createprice").val()),
        stock: parseInt($("#createstock").val())
      }),
      success: function () {
        $('#createModal').modal('hide');
        getlist();
      }
    });
  }

  // ================= UPDATE =================
  function EditShow(id, name, description, imgurl, price, stock) {
    $("#productid").val(id);
    $("#productname").val(name);
    $("#productdesc").val(description);
    $("#producturl").val(imgurl);
    $("#productprice").val(price);
    $("#productstock").val(stock);
    $('#editModal').modal('show');
  }

  function Update() {
    var id = $("#productid").val();

    $.ajax({
      url: '/api/products/' + id,
      type: 'PUT',
      contentType: 'application/json',
      headers: {
        Authorization: 'Bearer ' + token
      },
      data: JSON.stringify({
        name: $("#productname").val(),
        description: $("#productdesc").val(),
        img_url: $("#producturl").val(),
        price: parseFloat($("#productprice").val()),
        stock: parseInt($("#productstock").val())
      }),
      success: function () {
        $('#editModal').modal('hide');
        getlist();
      }
    });
  }

  // ================= DELETE =================
  var idtodelete = 0;

  function DeleteShow(id) {
    idtodelete = id;
    $('#deleteModal').modal('show');
  }

  function Delete() {
    $.ajax({
      url: '/api/products/' + idtodelete,
      type: 'DELETE',
      headers: {
        Authorization: 'Bearer ' + token
      },
      success: function () {
        $('#deleteModal').modal('hide');
        getlist();
      }
    });
  }

  getlist();
</script>


<!-- <script>
  var datas = []
  var token = localStorage.getItem("token") || "";
  function getlist() {

    $.ajax({
      url: '/api/products',
      type: 'GET',
      dataType: 'json',
      contentType: 'application/json',
      data: JSON.stringify({
        "token": token
      }),
      success: function (data) {
        console.log(data)
        datas = data
        drawdiv(datas)
      }
    });

  }
  function drawdiv(datas) {
    var productstring = document.getElementById("productlist")
    var str = ""
    for (var i = 0; i < datas.length; i++) {
      str += `<div class="col" data-name="` + datas[i].name + `" data-brand="` + datas[i].description + `" data-price="` + datas[i].price + `">
                              <div class="product-item card shadow-sm">
                                <img src="` + datas[i].imgurl + `" class="bd-placeholder-img card-img-top"
                                  alt="RTX 3070" style="height: 225px; object-fit: cover; width: 100%; border-color: black;">

                                <div class="card-body">
                                  <h5>` + datas[i].name + `</h5>
                                  <p class="card-text">Price : ` + datas[i].price.toLocaleString() + ` Baht</p>
                                  <p class="card-text">Qty : ` + datas[i].stock + `</p>
                                  <div class="d-flex justify-content-between align-items-center">
                                    <div class="btn-group">
                                      <button type="button" class="btn btn-sm btn-outline-secondary add-to-cart me-2" onclick="EditShow(${datas[i].id},'${datas[i].name}','${datas[i].description}','${datas[i].imgurl}',${datas[i].price},${datas[i].stock})">Update</button>
                                      <button type="button" class="btn btn-sm btn-outline-secondary add-to-cart text-danger" onclick="DeleteShow(${datas[i].id})">Delete</button>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>`
    }
    productstring.innerHTML = str
  }

  function openModalCreate() {
    $('#createModal').modal('show');
  }
  // ฟังก์ชั่น create
  function Create() {
    var cname = $("#createname").val()
    var cdescription = $("#createdesc").val()
    var cimgurl = $("#createurl").val()
    var cprice = parseFloat($("#createprice").val())
    var cstock = parseInt($("#createstock").val())

    console.log(cname, cdescription, cprice, cstock)
    $.ajax({
      url: '/api/products',
      type: 'POST',
      dataType: 'json',
      contentType: 'application/json',
      data: JSON.stringify({
        "token": token,
        "name": cname,
        "description": cdescription,
        "img_url": cimgurl,
        "price": cprice,
        "stock": cstock,
      }),
      success: function (data) {
        console.log(data)
        $('#createModal').modal('hide');
      }
    });
  }

  function EditShow(id, name, description, imgurl, price, stock) {
    $("#productid").val(id)
    $("#productname").val(name)
    $("#productdesc").val(description)
    $("#producturl").val(imgurl)
    $("#productprice").val(price)
    $("#productstock").val(stock)
    $('#editModal').modal('show');
  }

  var idtodelete = 0
  function DeleteShow(id) {
    idtodelete = id
    $('#deleteModal').modal('show');
  }

  function Update() {
    var id = $("#productid").val()
    var name = $("#productname").val()
    var description = $("#productdesc").val()
    var imgurl = $("#producturl").val()
    var price = parseFloat($("#productprice").val())
    var stock = parseInt($("#productstock").val())

    console.log(id, name, description, price, stock)
    $.ajax({
      url: '/api/products/' + id,
      type: 'PUT',
      dataType: 'json',
      contentType: 'application/json',
      data: JSON.stringify({
        "token": token,
        "id": id,
        "name": name,
        "description": description,
        "img_url": imgurl,
        "price": price,
        "stock": stock,
      }),
      success: function (data) {
        console.log(data)
        $('#editModal').modal('hide');
      }
    });

  }

  function Delete() {
    $.ajax({
      url: '/api/products/' + idtodelete,
      type: 'DELETE',
      dataType: 'json',
      contentType: 'application/json',
      data: JSON.stringify({
        "token": token,
        "id": idtodelete
      }),
      success: function (data) {
        console.log(data)
        $('#deleteModal').modal('hide');
      }
    });
  }

  getlist();





</script> -->